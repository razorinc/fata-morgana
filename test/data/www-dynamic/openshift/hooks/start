#!/bin/bash
#
# Copyright Â© 2010 Red Hat, Inc. All rights reserved
#
# This copyrighted material is made available to anyone wishing to use, modify,
# copy, or redistribute it subject to the terms and conditions of the GNU
# General Public License v.2.  This program is distributed in the hope that it
# will be useful, but WITHOUT ANY WARRANTY expressed or implied, including the
# implied warranties of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.  You should have
# received a copy of the GNU General Public License along with this program;
# if not, write to the Free Software Foundation, Inc., 51 Franklin Street,
# Fifth Floor, Boston, MA 02110-1301, USA. Any Red Hat trademarks that are
# incorporated in the source code or documentation are not subject to the GNU
# General Public License and may only be used or replicated with the express
# permission of Red Hat, Inc.
#

# Exit on errors.
set -e


#
# _main()
#
source $(cd -P -- "$(dirname -- "$0")" && pwd -P)/common.sh
[ $# -ge 1 ]  ||  os_print_hook_usage

comp_guid=${OPENSHIFT_COMPONENT_GUID:-""}
cfgdir=${OPENSHIFT_APP_PROD_DIR:-"."}/$app_config_subdir/$comp_guid
cfgfile="$cfgdir/conf/httpd.conf"

#  Ensure configuration exists for the component.
if ! test -f "$cfgfile"; then
   die 2 "Missing configuration file - $cfgfile"
fi


#  Setup command line options.
user_name=`id -un`
group_name=`id -gn`
if [ "$user_name" = "root" ]; then
   user_name="apache"
   group_name="apache"
fi

rundir="${OPENSHIFT_APP_PROD_DIR:-"."}"
[ -d "$rundir/var/run" ]  ||  mkdir -p "$rundir/var/run"

cd "$rundir"
/usr/sbin/httpd -f $cfgfile -C "User $user_name" -C "Group $group_name"  \
                -k $hook_name
os_log_notice "$@ + opts=${httpd_opts}"
exit 0
